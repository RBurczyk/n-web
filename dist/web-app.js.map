{"version":3,"file":"web-app.js","sourceRoot":"","sources":["../src/web-app.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,yBAA2B;AAC3B,8CAAgD;AAChD,iCAAuD;AACvD,2CAAoC;AACpC,mCAAkC;AAElC,SAAS;AACT;IAQI,gBAAmB,IAAY;QAE3B,mBAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,cAAc,EAAE,CAAC;QACrC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,IAAI,GAAG,IAAI,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,UAAU,GAAG,IAAI,kBAAS,EAAE,CAAC;QAClC,IAAI,CAAC,OAAO,GAAG,IAAI,eAAM,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;IAC1D,CAAC;IAEM,oCAAmB,GAA1B;QAA2B,qBAA0B;aAA1B,UAA0B,EAA1B,qBAA0B,EAA1B,IAA0B;YAA1B,gCAA0B;;QAEjD,CAAA,KAAA,IAAI,CAAC,OAAO,CAAA,CAAC,mBAAmB,WAAI,WAAW,EAAE;QACjD,MAAM,CAAC,IAAI,CAAC;;IAChB,CAAC;IAEM,kCAAiB,GAAxB,UAAyB,SAA6B;QAElD,mBAAK,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC,cAAc,EAAE,CAAC;QAC/C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACnC,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAEM,0BAAS,GAAhB;QAEI,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC1B,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC,eAAe;QACxC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACjC,CAAC;IAEO,mCAAkB,GAA1B;QAEI,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;IAChC,CAAC;IAEO,iCAAgB,GAAxB;QAAA,iBAOC;QALG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,UAAO,GAAG,EAAE,IAAI;;;;wBAE1B,GAAG,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;wBAChD,qBAAM,IAAI,EAAE,EAAA;;wBAAZ,SAAY,CAAC;;;;aAChB,CAAC,CAAC;IACP,CAAC;IAEO,oCAAmB,GAA3B;QAEI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC;IACjD,CAAC;IAEO,iCAAgB,GAAxB;QAEI,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,CAAC;IACpC,CAAC;IACL,aAAC;AAAD,CAAC,AA9DD,IA8DC;AA9DY,wBAAM","sourcesContent":["import * as Koa from \"koa\";\nimport * as KoaBodyParser from \"koa-bodyparser\";\nimport { Container, ComponentInstaller } from \"n-ject\";\nimport { given } from \"n-defensive\";\nimport { Router } from \"./router\";\n\n// public\nexport class WebApp\n{\n    private readonly _port: number;\n    private readonly _koa: Koa;\n    private readonly _container: Container;\n    private readonly _router: Router;\n    \n    \n    public constructor(port: number)\n    {\n        given(port, \"port\").ensureHasValue();\n        this._port = port;\n        this._koa = new Koa();\n        this._container = new Container();\n        this._router = new Router(this._koa, this._container);\n    }\n    \n    public registerControllers(...controllers: Function[]): this\n    {\n        this._router.registerControllers(...controllers);\n        return this;\n    }\n    \n    public registerInstaller(installer: ComponentInstaller): this\n    {\n        given(installer, \"installer\").ensureHasValue();\n        this._container.install(installer);\n        return this;\n    }\n    \n    public bootstrap(): void\n    {\n        this.configureContainer();\n        this.configureScoping();\n        this.configureBodyParser();\n        this.configureRouting(); // must be last\n        this._koa.listen(this._port);\n    }\n    \n    private configureContainer(): void\n    {\n        this._container.bootstrap();\n    }\n    \n    private configureScoping(): void\n    {\n        this._koa.use(async (ctx, next) =>\n        {\n            ctx.state.scope = this._container.createScope();\n            await next();\n        });\n    }\n    \n    private configureBodyParser()\n    {\n        this._koa.use(KoaBodyParser({strict: true}));\n    }\n    \n    private configureRouting(): void\n    {\n        this._router.configureRouting();\n    }\n}"]}